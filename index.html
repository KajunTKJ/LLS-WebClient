<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LLS Mobile Controller</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #lobby, #landing { display: none; }
    button { padding: 1em; margin: 0.5em; font-size: 1em; }
    #playerList { margin-top: 1em; }
  </style>
</head>
<body>

<div id="landing">
  <h1>Lucky Lunar Shuffle</h1>
  <input type="text" id="usernameInput" placeholder="Enter username (max 12)">
  <button id="playBtn">Play</button>
  <div>
    <input type="text" id="codeInput" placeholder="Enter lobby code">
    <button id="joinCodeBtn">Join Code</button>
  </div>
  <button id="createBtn">Create Lobby</button>
</div>

<div id="lobby">
  <h2>Lobby: <span id="lobbyCode"></span></h2>
  <div id="playerList"></div>
  <button id="leaveBtn">Leave Lobby</button>
  <div id="controls">
    <!-- Future game controls go here -->
  </div>
</div>

<script>
const serverUrl = "wss://lls-server-production-cde6.up.railway.app"
let ws
let currentLobby = null

function showLanding() {
  document.getElementById("landing").style.display = "block"
  document.getElementById("lobby").style.display = "none"
}

function showLobby() {
  document.getElementById("landing").style.display = "none"
  document.getElementById("lobby").style.display = "block"
}

function connectWS() {
  if (ws && ws.readyState === WebSocket.OPEN) return

  ws = new WebSocket(serverUrl)

  ws.onopen = () => { console.log("Connected to server") }

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data)
    console.log("Received:", data)

    if (data.type === "LOBBY_STATE") {
      currentLobby = data
      document.getElementById("lobbyCode").textContent = data.lobbyId
      const players = data.players.map(p => `<div>${p.username} (${p.playerId})</div>`).join("")
      document.getElementById("playerList").innerHTML = players
      showLobby()
    }

    if (data.type === "LEFT_LOBBY" || data.type === "ERROR") {
      currentLobby = null
      showLanding()
    }
  }

  ws.onclose = () => {
    console.log("Disconnected")
    showLanding()
  }
}

// --- Button Handlers ---

document.getElementById("playBtn").onclick = () => {
  const username = document.getElementById("usernameInput").value.trim().slice(0,12) || "Player"
  connectWS()
  ws.send(JSON.stringify({ type: "JOIN", username }))
}

document.getElementById("joinCodeBtn").onclick = () => {
  const code = document.getElementById("codeInput").value.trim()
  const username = document.getElementById("usernameInput").value.trim().slice(0,12) || "Player"
  if (!code) return alert("Enter a code!")
  connectWS()
  ws.send(JSON.stringify({ type: "JOIN_CODE", code, username }))
}

document.getElementById("createBtn").onclick = () => {
  const username = document.getElementById("usernameInput").value.trim().slice(0,12) || "Player"
  connectWS()
  ws.send(JSON.stringify({ type: "CREATE", username }))
}

document.getElementById("leaveBtn").onclick = () => {
  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: "LEAVE" }))
  }
}

// Show landing initially
showLanding()
</script>

</body>
</html>
