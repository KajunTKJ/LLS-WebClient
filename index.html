<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LLS Mobile Controller</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #lobby, #landing { display: none; }
    button { padding: 1em; margin: 0.5em; font-size: 1em; }
    #playerList { margin-top: 1em; }
  </style>
</head>
<body>

<div id="landing">
  <h1>Lucky Lunar Shuffle</h1>
  <button id="playBtn">Play</button>
  <div>
    <input type="text" id="codeInput" placeholder="Enter lobby code">
    <button id="joinCodeBtn">Join Code</button>
  </div>
</div>

<div id="lobby">
  <h2>Lobby: <span id="lobbyCode"></span></h2>
  <div id="playerList"></div>
  <button id="leaveBtn">Leave Lobby</button>
  <div id="controls">
    <!-- Future game controls go here -->
  </div>
</div>

<script>
const serverUrl = "wss://lls-server-production-cde6.up.railway.app"
let ws
let currentLobby = null

function showLanding() {
  document.getElementById("landing").style.display = "block"
  document.getElementById("lobby").style.display = "none"
}

function showLobby() {
  document.getElementById("landing").style.display = "none"
  document.getElementById("lobby").style.display = "block"
}

// Initialize WebSocket
function connectWS() {
  ws = new WebSocket(serverUrl)

  ws.onopen = () => {
    console.log("Connected to server")
  }

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data)
    console.log("Received:", data)

    if (data.type === "LOBBY_STATE") {
      currentLobby = data
      document.getElementById("lobbyCode").textContent = data.lobbyId
      const players = data.players.map(p => `<div>${p}</div>`).join("")
      document.getElementById("playerList").innerHTML = players
      showLobby()
    }

    if (data.type === "LEFT_LOBBY" || data.type === "ERROR") {
      currentLobby = null
      showLanding()
    }
  }

  ws.onclose = () => {
    console.log("Disconnected")
    showLanding()
  }
}

// Landing page buttons
document.getElementById("playBtn").onclick = () => {
  if (!ws || ws.readyState !== WebSocket.OPEN) connectWS()
  ws.send(JSON.stringify({ type: "JOIN" }))
}

document.getElementById("joinCodeBtn").onclick = () => {
  const code = document.getElementById("codeInput").value.trim()
  if (!code) return alert("Enter a code!")
  if (!ws || ws.readyState !== WebSocket.OPEN) connectWS()
  ws.send(JSON.stringify({ type: "JOIN_CODE", code }))
}

// Leave lobby button
document.getElementById("leaveBtn").onclick = () => {
  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: "LEAVE" }))
  }
}

// Show landing page initially
showLanding()
</script>

</body>
</html>
